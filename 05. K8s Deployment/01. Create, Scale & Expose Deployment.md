# ğŸš€ **Kubernetes Deployment â€” Full SOP**

---

## ğŸ“˜ **Title**

**Kubernetes - Deployment**

## ğŸ§­ **Description**

Learn and Implement Kubernetes Deployment

---

## ğŸ“š **Kubernetes Deployment - Topics**

| #   | Topic                                                 |
| --- | ----------------------------------------------------- |
| 1ï¸âƒ£ | Create Deployment                                     |
| 2ï¸âƒ£ | Scale the Deployment                                  |
| 3ï¸âƒ£ | Expose Deployment as a Service                        |
| 4ï¸âƒ£ | Update Deployment                                     |
| 5ï¸âƒ£ | Rollback Deployment                                   |
| 6ï¸âƒ£ | Rolling Restarts                                      |
| 7ï¸âƒ£ | Pause & Resume Deployments                            |
| 8ï¸âƒ£ | Canary Deployments *(Covered in Declarative Section)* |

---

## ğŸª„ **Step-01: Introduction to Deployments**

### ğŸ’¡ What is a Deployment?

A **Kubernetes Deployment** manages **ReplicaSets** and ensures your desired state (number of pods, image version, etc.) is always maintained automatically.

### ğŸ§© What can we do using Deployment?

* âœ… Create a Deployment
* âœ… Scale the Deployment
* âœ… Expose it as a Service
* âœ… Update or Rollback versions
* âœ… Perform rolling restarts
* âœ… Pause and resume rollouts

---

## âš™ï¸ **Step-02: Create Deployment**

### ğŸ¯ Objective

Create a Deployment that automatically manages a ReplicaSet and Pods.

**Docker Image:**
ğŸ”— [https://hub.docker.com/repository/docker/stacksimplify/kubenginx](https://hub.docker.com/repository/docker/stacksimplify/kubenginx)

---

### ğŸ§± **Create Deployment**

```bash
# Create Deployment
kubectl create deployment <Deplyment-Name> --image=<Container-Image>
kubectl create deployment my-first-deployment --image=stacksimplify/kubenginx:1.0.0 
```

---

### ğŸ” **Verify Deployment**

```bash
# Verify Deployment
kubectl get deployments
kubectl get deploy 
```

---

### ğŸ§¾ **Describe Deployment**

```bash
# Describe Deployment
kubectl describe deployment <deployment-name>
kubectl describe deployment my-first-deployment
```

---

### ğŸ§© **Verify ReplicaSet**

```bash
# Verify ReplicaSet
kubectl get rs
```

---

### ğŸ§ª **Verify Pod**

```bash
# Verify Pod
kubectl get po
```

---

## ğŸ§  **Update Change-Cause for the Kubernetes Deployment - Rollout History**

> ğŸ¯ **Observation:**
> Kubernetes tracks **rollout history** for Deployments, allowing easy rollback to previous revisions.

---

### ğŸ” **Verify Rollout History**

```bash
# Verify Rollout History
kubectl rollout history deployment/my-first-deployment
```

---

### ğŸ·ï¸ **Update REVISION CHANGE-CAUSE for Kubernetes Deployment**

```bash
# Update REVISION CHANGE-CAUSE for Kubernetes Deployment
kubectl annotate deployment/my-first-deployment kubernetes.io/change-cause="Deployment CREATE - App Version 1.0.0"
```

---

### ğŸ“œ **Verify Rollout History Again**

```bash
# Verify Rollout History
kubectl rollout history deployment/my-first-deployment
```

---

## ğŸ“ˆ **Step-03: Scaling a Deployment**

Scaling helps in handling more load by increasing replicas or optimizing resource cost by scaling down.

---

### ğŸ”¼ **Scale Up the Deployment**

```bash
# Scale Up the Deployment
kubectl scale --replicas=10 deployment/<Deployment-Name>
kubectl scale --replicas=10 deployment/my-first-deployment 
```

---

### âœ… **Verify Deployment**

```bash
# Verify Deployment
kubectl get deploy
```

---

### ğŸ” **Verify ReplicaSet**

```bash
# Verify ReplicaSet
kubectl get rs
```

---

### ğŸ” **Verify Pods**

```bash
# Verify Pods
kubectl get po
```

---

### ğŸ”½ **Scale Down the Deployment**

```bash
# Scale Down the Deployment
kubectl scale --replicas=2 deployment/my-first-deployment 
kubectl get deploy
```

---

## ğŸŒ **Step-04: Expose Deployment as a Service**

Expose Deployment with a **LoadBalancer Service** to access the app externally from the internet.

---

### ğŸŒ **Expose Deployment**

```bash
# Expose Deployment as a Service
kubectl expose deployment <Deployment-Name>  --type=LoadBalancer --port=80 --target-port=80 --name=<Service-Name-To-Be-Created>
kubectl expose deployment my-first-deployment --type=LoadBalancer --port=80 --target-port=80 --name=my-first-deployment-service
```

---

### ğŸ“¡ **Get Service Info**

```bash
# Get Service Info
kubectl get svc
```

---

### ğŸ§­ **Access the Application using Public IP**

```bash
# Access Application
http://<External-IP-from-get-service-output>
curl http://<External-IP-from-get-service-output>
```

---

## ğŸ§© **Visual Summary**

### âš™ï¸ Deployment Flow

```text
Deployment
   â”‚
   â”œâ”€â”€ Controls ReplicaSet(s)
   â”‚       â””â”€â”€ Controls Pods
   â”‚               â””â”€â”€ Runs Container(s)
```

### ğŸ§  Deployment vs ReplicaSet vs Pod

| Resource       | Role                                       | Managed By | Use Case                  |
| -------------- | ------------------------------------------ | ---------- | ------------------------- |
| **Pod**        | Smallest deployable unit (runs containers) | ReplicaSet | Runs the app              |
| **ReplicaSet** | Ensures desired number of Pods             | Deployment | Maintains HA              |
| **Deployment** | Manages ReplicaSets and updates            | User       | Rolling updates, rollback |

---

## ğŸ§° **Real-World Use Case**

Imagine your web app runs fine with 3 pods, but during traffic spikes (e.g., festive season), you need more capacity.
You simply scale:

```bash
kubectl scale --replicas=10 deployment/my-first-deployment
```

No downtime, no manual container management â€” Kubernetes handles it all automatically. âš¡

---

## ğŸ§¾ **Quick Reference Table**

| Task                | Command                                                | Description              |
| ------------------- | ------------------------------------------------------ | ------------------------ |
| Create Deployment   | `kubectl create deployment <name> --image=<image>`     | Create new deployment    |
| View Deployment     | `kubectl get deploy`                                   | List all deployments     |
| Scale Deployment    | `kubectl scale --replicas=<n> deployment/<name>`       | Change pod count         |
| Describe Deployment | `kubectl describe deployment <name>`                   | Get detailed info        |
| Rollout History     | `kubectl rollout history deployment/<name>`            | See deployment revisions |
| Expose as Service   | `kubectl expose deployment <name> --type=LoadBalancer` | Create public endpoint   |

---

## âœ… **Key Takeaways**

* Deployment = top-level controller managing rollout, scale, and rollback.
* ReplicaSets handle pod count; Deployments handle ReplicaSets.
* Scaling and exposing services are seamless and zero-downtime.
* Rollout history = your safety net for quick version rollback.

---
