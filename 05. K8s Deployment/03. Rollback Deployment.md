# ğŸŒ€ **Kubernetes - Rollback Deployment**

**ğŸ¯ Description:** Learn and Implement Kubernetes Rollback Deployment

---

## ğŸ§© **Step-00: Introduction**

We can rollback a deployment in two ways:

* ğŸ” **Previous Version** â€” revert to the immediate last version.
* ğŸ¯ **Specific Version** â€” revert to any particular revision number from history.

ğŸ’¬ **Althea Comment:**
Rollback is one of the most powerful Kubernetes features â€” it saves you from production failures. Instead of manually redeploying, you can instantly go back to a stable release.

---

## ğŸ§± **Step-01: Rollback a Deployment to Previous Version**

### âœ… **Check the Rollout History of a Deployment**

```bash
# List Deployment Rollout History
kubectl rollout history deployment/<Deployment-Name>
kubectl rollout history deployment/my-first-deployment  
```

ğŸ’¬ **Althea Comment:**
This shows a list of **revision numbers** (1, 2, 3, etc.). Each revision corresponds to one deployment update. Youâ€™ll need these numbers to identify which version you want to rollback to.

---

### ğŸ” **Verify changes in each revision**

```bash
# List Deployment History with revision information
kubectl rollout history deployment/my-first-deployment --revision=1
kubectl rollout history deployment/my-first-deployment --revision=2
kubectl rollout history deployment/my-first-deployment --revision=3
```

ğŸ’¬ **Althea Comment:**
Use this to check **annotations** and **container image tags** per revision.
Example: You might see `stacksimplify/kubenginx:2.0.0` in revision 2 and `3.0.0` in revision 3.

---

### âª **Rollback to Previous Version**

```bash
# Undo Deployment
kubectl rollout undo deployment/my-first-deployment
```

ğŸ’¬ **Althea Comment:**
This command automatically rolls back to the **previous revision** (for example, from 3 â†’ 2).
After rollback, Kubernetes creates a **new revision number** (e.g., revision 4), representing this rollback action itself.

---

### ğŸ“œ **List Deployment Rollout History**

```bash
# List Deployment Rollout History
kubectl rollout history deployment/my-first-deployment  
```

ğŸ’¬ **Althea Comment:**
Confirm that a new revision has been created (like revision 4). This keeps your rollback traceable in history.

---

### ğŸ” **Verify Deployment, Pods, ReplicaSets**

```bash
# Verify Deployment, Pods, ReplicaSets
kubectl get deploy
kubectl get rs
kubectl get po
kubectl describe deploy my-first-deployment
```

ğŸ’¬ **Althea Comment:**
Hereâ€™s what to check:

* The **ReplicaSet** corresponding to the previous version is now active.
* The old ReplicaSet for the newer version will show fewer or zero pods.

---

### ğŸŒ **Access the Application using Public IP**

```bash
# Get Load Balancer IP
kubectl get svc

# Application URL
http://<External-IP-from-get-service-output>
```

ğŸ’¬ **Althea Comment:**
The page should show **Application Version: V2**, confirming rollback success.

---

## ğŸ§± **Step-02: Rollback to Specific Revision**

### ğŸ“œ **Check the Rollout History of a Deployment**

```bash
# List Deployment Rollout History
kubectl rollout history deployment/<Deployment-Name>
kubectl rollout history deployment/my-first-deployment 
```

ğŸ’¬ **Althea Comment:**
If you want to jump to a specific version (not just the last one), note the **revision number** you want to restore to.

---

### ğŸ¯ **Rollback to Specific Revision**

```bash
# Rollback Deployment to Specific Revision
kubectl rollout undo deployment/my-first-deployment --to-revision=3
```

ğŸ’¬ **Althea Comment:**
This command forces Kubernetes to restore your deployment to **revision 3**.
Youâ€™ll see a new revision (like revision 5) created in history, representing this rollback operation.

---

### ğŸ§¾ **List Deployment History**

```bash
# List Deployment Rollout History
kubectl rollout history deployment/my-first-deployment
```

ğŸ’¬ **Althea Comment:**
Verify that the rollback has been applied and a new revision entry (5) appears in the list.

---

### ğŸŒ **Access the Application using Public IP**

```bash
# Get Load Balancer IP
kubectl get svc

# Application URL
http://<Load-Balancer-IP>
```

ğŸ’¬ **Althea Comment:**
You should see **Application Version: V3**, confirming the rollback to that specific revision.

---

## ğŸ” **Step-03: Rolling Restarts of Application**

Rolling restarts will kill the existing pods and recreate new pods in a **rolling fashion** (one by one, ensuring no downtime).

```bash
# Rolling Restarts
kubectl rollout restart deployment/<Deployment-Name>
kubectl rollout restart deployment/my-first-deployment

# Get list of Pods
kubectl get po
```

ğŸ’¬ **Althea Comment:**
This is **not a rollback** â€” it just triggers pod recreation using the **same configuration**.
Use this to refresh application pods when configurations or secrets are updated (without changing the image).

---

