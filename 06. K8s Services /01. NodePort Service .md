# ğŸ¯ **GCP Google Kubernetes Engine (GKE) NodePort Service**

---

### ğŸ§© **Title**

**GCP Google Kubernetes Engine GKE NodePort Service**

### ğŸ“ **Description**

**Implement GCP Google Kubernetes Engine GKE NodePort Service**

---

## âš™ï¸ **Step-00: Pre-requisites**

Before starting, ensure that your **GKE cluster** is running and that **kubectl** is configured properly.

---

### âœ… **Verify GKE Cluster & kubeconfig**

```bash
# Configure kubeconfig for kubectl
gcloud container clusters get-credentials <CLUSTER-NAME> --region <REGION> --project <PROJECT>
```

ğŸ‘‰ **Replace values:**

* `<CLUSTER-NAME>`
* `<REGION>`
* `<PROJECT>`

---

### ğŸ§  **Example Command**

```bash
gcloud container clusters get-credentials standard-public-cluster-1 --region us-central1 --project kdaida123
```

---

### ğŸ“‹ **Verify GKE Worker Nodes**

```bash
# List GKE Kubernetes Worker Nodes
kubectl get nodes

# List GKE Kubernetes Worker Nodes with -o wide option
kubectl get nodes -o wide
```

---

### ğŸ” **Observation**

1ï¸âƒ£ You should see **External-IP Address** (Public IP accessible via Internet).
2ï¸âƒ£ This **External-IP** is essential for testing the **NodePort Service** on GKE.

---

### ğŸŒ **Visual Concept**

```text
User (Browser) ğŸŒ
        |
        v
  GKE Worker Node ğŸ§©
 (Has External IP)
        |
   NodePort Service ğŸšª (Port 30080)
        |
        v
   Kubernetes Pod ğŸ§±
```

---

## ğŸš€ **Step-01: Introduction**

Implement **Kubernetes NodePort Service** on **Google Kubernetes Engine (GKE)**.

---

## ğŸ§± **Step-02: 01-kubernetes-deployment.yaml**

### ğŸ“„ **File:** `01-kubernetes-deployment.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment 
metadata: #Dictionary
  name: myapp1-deployment
spec: # Dictionary
  replicas: 2
  selector:
    matchLabels:
      app: myapp1
  template:  
    metadata: # Dictionary
      name: myapp1-pod
      labels: # Dictionary
        app: myapp1  # Key value pairs
    spec:
      containers: # List
        - name: myapp1-container
          image: stacksimplify/kubenginx:1.0.0
          ports: 
            - containerPort: 80
```

---

### ğŸ§© **Deployment Details**

| ğŸ”§ Field          | ğŸ’¬ Description                                |
| ----------------- | --------------------------------------------- |
| **apiVersion**    | `apps/v1` (Deployment API version)            |
| **kind**          | Defines resource type as `Deployment`         |
| **metadata.name** | Name of Deployment â†’ `myapp1-deployment`      |
| **replicas**      | Ensures 2 Pods always running                 |
| **selector**      | Matches Pods with label `app: myapp1`         |
| **containerPort** | Container listens on port `80`                |
| **image**         | `stacksimplify/kubenginx:1.0.0` (Nginx image) |

---

## ğŸŒ **Step-03: 02-kubernetes-nodeport-service.yaml**

> ğŸ’¡ If you donâ€™t specify `nodePort: 30080`, it will dynamically assign one port from range **30000â€“32768**

---

### ğŸ“„ **File:** `02-kubernetes-nodeport-service.yaml`

```yaml
apiVersion: v1
kind: Service 
metadata:
  name: myapp1-nodeport-service
spec:
  type: NodePort # clusterIP, # NodePort, # LoadBalancer, # ExternalName
  selector:
    app: myapp1
  ports: 
    - name: http
      port: 80 # Service Port
      targetPort: 80 # Container Port
      nodePort: 30080 # NodePort (Optional)(Node Port Range: 30000-32768)
```

---

### âš™ï¸ **NodePort Service Breakdown**

| ğŸ§± Field       | ğŸ“˜ Description                                     |
| -------------- | -------------------------------------------------- |
| **type**       | `NodePort` exposes service on a port on every node |
| **port**       | Cluster-internal service port (`80`)               |
| **targetPort** | Container port inside the Pod (`80`)               |
| **nodePort**   | External Node Port (`30080`) for external access   |
| **selector**   | Connects service to Pods with label `app: myapp1`  |

---

### ğŸŒˆ **Visual Flow: NodePort Architecture**

```text
User Browser ğŸŒ
    |
    v
Node External IP:30080 ğŸŒ  <-- (Firewall must allow this)
    |
    v
Service (NodePort) ğŸšª
    |
    v
Pod(s) running Nginx ğŸ§±
```

---

## âš™ï¸ **Step-04: Deploy Kubernetes Manifests**

```bash
# Deploy Kubernetes Manifests
kubectl apply -f kube-manifests

# List Deployments
kubectl get deploy

# List Pods
kubectl get po

# List Services
kubectl get svc
```

---

### ğŸ§¾ **Expected Output Example**

| Resource   | Status                             |
| ---------- | ---------------------------------- |
| Deployment | 2/2 Pods Running âœ…                 |
| Service    | NodePort created on port `30080` âœ… |
| Pods       | `myapp1-pod` instances running âœ…   |

---

## ğŸŒ **Step-05: Access Application**

```bash
# List Kubernetes Worker Node with -o wide
kubectl get nodes -o wide
```

---

### ğŸ” **Observation**

1ï¸âƒ£ Make a note of any **Node External-IP (Public IP Address)**

---

### ğŸŒ **Access Application**

```bash
http://<NODE-EXTERNAL-IP>:<NodePort>
# Example
http://104.154.52.12:30080
```

---

### âš ï¸ **Observation**

1ï¸âƒ£ This should **fail initially**, as firewall rules do not yet allow traffic on port `30080`.

---

## ğŸ”¥ **Step-06: Create Firewall Rule**

### âš™ï¸ **Commands**

```bash
# Create Firewall Rule
gcloud compute firewall-rules create fw-rule-gke-node-port \
    --allow tcp:NODE_PORT
```

---

### ğŸ§© **Example**

```bash
# Replace NODE_PORT
gcloud compute firewall-rules create fw-rule-gke-node-port \
    --allow tcp:30080   
```

---

### ğŸ“‹ **List Firewall Rules**

```bash
gcloud compute firewall-rules list
```

---

### ğŸ” **Firewall Rule Explanation**

| ğŸ”§ Option          | ğŸ’¬ Description                                 |
| ------------------ | ---------------------------------------------- |
| **Rule Name**      | `fw-rule-gke-node-port`                        |
| **Allow Protocol** | TCP                                            |
| **Port**           | `30080`                                        |
| **Purpose**        | Allow external traffic to GKE NodePort service |

---

## ğŸŒ **Step-07: Access Application**

```bash
# List Kubernetes Worker Node with -o wide
kubectl get nodes -o wide
```

---

### ğŸ” **Observation**

1ï¸âƒ£ Make a note of any **Node External-IP (Public IP Address)**

---

### ğŸŒ **Access Application**

```bash
http://<NODE-EXTERNAL-IP>:<NodePort>
# Example
http://104.154.52.12:30080
```

---

### âœ… **Observation**

1ï¸âƒ£ This time it should **PASS** â€” application will be successfully accessible from the browser ğŸ‰

---

### ğŸ’¡ **Visual Confirmation Flow**

```text
Firewall âœ…  --->  GKE Node External IP ğŸŒ  --->  NodePort 30080 ğŸšª  --->  Pod ğŸ§±
```

---

## ğŸ§¹ **Step-08: Clean-Up**

### âš™ï¸ **Commands**

```bash
# Delete Kubernetes Resources
kubectl delete -f kube-manifests

# Delete NodePort Service Firewall Rule
gcloud compute firewall-rules delete fw-rule-gke-node-port

# List Firewall Rules
gcloud compute firewall-rules list
```

---

### ğŸ§¾ **Cleanup Verification**

| ğŸ§© Resource       | ğŸ’¬ Expected Result |
| ----------------- | ------------------ |
| **Pods**          | Deleted            |
| **Deployment**    | Removed            |
| **Service**       | NodePort deleted   |
| **Firewall Rule** | Deleted from GCP   |

---

## ğŸ“š **Summary Table**

| ğŸ§­ Step   | ğŸ§  Description             | ğŸ§¾ Key Output                       |
| --------- | -------------------------- | ----------------------------------- |
| **00**    | Pre-requisites             | GKE cluster + kubeconfig setup      |
| **01â€“03** | Deployment + NodePort YAML | Creates 2 Pods + NodePort Service   |
| **04**    | Deploy Manifests           | All Kubernetes resources up         |
| **05**    | Access App (Fails)         | Firewall not open                   |
| **06â€“07** | Create Firewall + Test     | NodePort app accessible             |
| **08**    | Cleanup                    | Deletes resources and firewall rule |

---

### ğŸ“ **Complete Workflow Diagram**

```text
[01-kubernetes-deployment.yaml] --> Creates --> 2 Pods (myapp1)
                                  |
                                  v
[02-kubernetes-nodeport-service.yaml] --> Exposes Pods on NodePort 30080
                                  |
                                  v
Firewall Rule (fw-rule-gke-node-port) --> Allows external traffic ğŸŒ
                                  |
                                  v
Access via http://<Node-External-IP>:30080 ğŸš€
```

---

### ğŸ **End of SOP**

âœ… You have successfully:

* Configured **kubectl** with your GKE cluster â˜ï¸
* Created a **Deployment** and **NodePort Service** ğŸ§©
* Opened **GCP Firewall** for NodePort access ğŸ”¥
* Accessed your app using **Node External IP + NodePort** ğŸŒ
* Cleaned up all resources ğŸ§¹

---

