Absolutely! Here’s your **SOP for PersistentVolume (PV) & PersistentVolumeClaim (PVC)** in Kubernetes, structured in a detailed yet accessible format. The step-by-step guide will include commands, concepts, visualizations, and important notes, making it easy for you or your team to follow along.

---

# 🧭 **Standard Operating Procedure (SOP)**

## 📦 **PersistentVolume (PV) & PersistentVolumeClaim (PVC) in Kubernetes**

---

### 🏷️ **Title**

**Kubernetes PersistentVolume (PV) & PersistentVolumeClaim (PVC)**

### 🧾 **Description**

**Learn to create and manage PersistentVolumes (PVs) and PersistentVolumeClaims (PVCs) in Kubernetes for managing storage.**

---

## ⚙️ **Step-00: Pre-requisites**

Before we begin working with **PersistentVolumes** and **PersistentVolumeClaims**, ensure that you have:

* A **Kubernetes cluster** up and running.
* `kubectl` configured to interact with the cluster.

---

### 🧠 **Verify Cluster Setup**

```bash
# Check nodes in the cluster
kubectl get nodes
```

---

### 🧩 **Verify Storage Class**

Kubernetes PV and PVC depend on storage classes, so ensure that a **default StorageClass** exists in your cluster.

```bash
kubectl get storageclass
```

If the output shows `default` storage class, you are good to go!

---

## 🧱 **Step-01: Introduction to PersistentVolume (PV) and PersistentVolumeClaim (PVC)**

* **PersistentVolume (PV)** is a piece of storage in the cluster that has been provisioned by an administrator or dynamically by Kubernetes. It can be backed by different types of storage (local, NFS, cloud storage like GCE, AWS EBS, etc.).

* **PersistentVolumeClaim (PVC)** is a request for storage by a user. It is like a "binding" to the underlying PersistentVolume that fulfills the claim. PVCs allow users to abstract storage configurations.

---

### 🔑 **Key Concepts:**

| Term                            | Definition                                                                                   |
| ------------------------------- | -------------------------------------------------------------------------------------------- |
| **PersistentVolume (PV)**       | A resource in Kubernetes that represents storage in the cluster.                             |
| **PersistentVolumeClaim (PVC)** | A request for storage by a user or application in the cluster.                               |
| **StorageClass**                | Describes the "types" of storage in the cluster. It is used for dynamic provisioning of PVs. |
| **Binding**                     | The process that matches a PVC to a PV. PVCs get bound to PVs dynamically or manually.       |

---

## 🧩 **Step-02: Create PersistentVolume (PV)**

### 📄 **Create PV YAML File:**

Below is an example YAML definition for creating a **PersistentVolume** in Kubernetes. You can use any storage backend supported by Kubernetes (e.g., NFS, GCE, EBS, etc.).

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: my-pv
spec:
  capacity:
    storage: 5Gi  # Size of the storage requested
  accessModes:
    - ReadWriteOnce  # Access mode - this one allows mounting by a single node
  persistentVolumeReclaimPolicy: Retain  # Keep the volume when PVC is deleted
  storageClassName: standard  # Reference to StorageClass
  hostPath:
    path: "/"  # Path to the storage on the node (e.g., NFS, cloud storage, etc.)
```

### 🧩 **Explanation of Fields:**

| Field                             | Description                                                                                    |
| --------------------------------- | ---------------------------------------------------------------------------------------------- |
| **capacity**                      | Defines the amount of storage the PV will provide.                                             |
| **accessModes**                   | Defines the access modes for the PV (e.g., `ReadWriteOnce`, `ReadOnlyMany`).                   |
| **persistentVolumeReclaimPolicy** | Defines the action Kubernetes will take when a PVC is deleted. (`Retain`, `Recycle`, `Delete`) |
| **storageClassName**              | The name of the `StorageClass` to which this PV belongs.                                       |
| **hostPath**                      | Storage location (specific to node, useful for local storage).                                 |

---

### 🔨 **Create PersistentVolume (PV)**

```bash
# Apply the PersistentVolume YAML file
kubectl apply -f my-pv.yaml

# Check the PV status
kubectl get pv
```

---

## 🧩 **Step-03: Create PersistentVolumeClaim (PVC)**

Now let’s create a **PersistentVolumeClaim (PVC)** to request storage from the PV.

### 📄 **Create PVC YAML File:**

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  accessModes:
    - ReadWriteOnce  # Same as PV access mode
  resources:
    requests:
      storage: 3Gi  # Size of storage requested (must be less than or equal to PV capacity)
  storageClassName: standard  # Storage class to be used (should match PV StorageClass)
```

---

### 🧩 **Explanation of PVC Fields:**

| Field                          | Description                                                                      |
| ------------------------------ | -------------------------------------------------------------------------------- |
| **accessModes**                | Specifies the access mode for the PVC (should match PV).                         |
| **resources.requests.storage** | Specifies the amount of storage being requested (must not exceed PV capacity).   |
| **storageClassName**           | Refers to the StorageClass that should be used (should match PV's StorageClass). |

---

### 🔨 **Create PersistentVolumeClaim (PVC)**

```bash
# Apply the PersistentVolumeClaim YAML file
kubectl apply -f my-pvc.yaml

# Check the PVC status
kubectl get pvc
```

---

### 🧠 **Observe PVC Binding**

Once the PVC is created, Kubernetes will try to **bind** it to an available PV that matches the requested size, access mode, and storage class.

```bash
kubectl get pv
```

You should see that the **PVC** is **bound** to a **PV**.

---

## 🧩 **Step-04: Use PVC in a Pod**

Now that we have a PV and PVC, let’s mount the PVC in a Pod to use the storage.

### 📄 **Pod YAML Definition:**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-app-container
    image: nginx
    volumeMounts:
    - mountPath: "/usr/share/nginx/html"
      name: my-pvc-volume
  volumes:
  - name: my-pvc-volume
    persistentVolumeClaim:
      claimName: my-pvc  # Reference to the PVC
```

### 🧩 **Explanation of Fields:**

| Field                                       | Description                                                                |
| ------------------------------------------- | -------------------------------------------------------------------------- |
| **volumeMounts.mountPath**                  | Specifies the directory in the container where the volume will be mounted. |
| **volumes.persistentVolumeClaim.claimName** | References the **PVC** we created earlier.                                 |

---

### 🔨 **Create Pod with PVC Mounted**

```bash
# Apply the Pod YAML file
kubectl apply -f my-app-pod.yaml

# Check Pod status
kubectl get pods
```

---

### 📍 **Verify Storage Access**

Once the Pod is running, you can verify the volume has been correctly mounted by **accessing the container** and listing the contents.

```bash
# Open a shell in the Pod
kubectl exec -it my-app -- sh

# List the contents in the mounted directory
ls /usr/share/nginx/html
```

---

## 🧩 **Step-05: Resize PVC (Optional)**

In some cases, you may need to resize the PVC after it has been created. Here’s how you can do it:

### 🔨 **Resize PVC Command:**

1. **Edit the PVC:**

```bash
kubectl edit pvc my-pvc
```

2. **Change the storage request** in the YAML to the desired size (ensure it’s smaller than or equal to the PV’s capacity).

Example:

```yaml
resources:
  requests:
    storage: 10Gi
```

3. **Save and exit.**

4. **Check the new size:**

```bash
kubectl get pvc my-pvc
```

---

## 🧩 **Step-06: Delete PV and PVC**

Finally, if you want to delete the **PV** and **PVC**, follow these steps.

### 🔨 **Delete PVC and PV:**

```bash
# Delete PVC first (because the PV might be in use)
kubectl delete pvc my-pvc

# Delete PV
kubectl delete pv my-pv
```

---

## 📘 **Key Takeaways:**

* **PersistentVolume (PV)** is storage in the cluster; **PersistentVolumeClaim (PVC)** is a request for storage.
* PVCs abstract storage details, allowing users to request storage without worrying about the specifics of the backend.
* **StorageClass** allows Kubernetes to dynamically provision storage for PVs.
* PVs can be bound to a specific PVC or dynamically provisioned depending on your cluster configuration.

---

### 🌐 **Visual Summary of PV and PVC Flow**

```text
User → PVC → PV → Pod (mounted volume)
```

---

## 🧹 **Clean-up Table**

| Action     | Command                     |
| ---------- | --------------------------- |
| Delete PVC | `kubectl delete pvc my-pvc` |
| Delete PV  | `kubectl delete pv my-pv`   |
| Delete Pod | `kubectl delete pod my-app` |
