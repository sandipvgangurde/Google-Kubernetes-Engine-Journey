
# ğŸ¯  ** Kubernetes **

---

### ğŸ§© **Title**

**Kubernetes ReplicaSets with YAML**

### ğŸ“ **Description**

**Learn to write and test Kubernetes ReplicaSets with YAML**

---

## ğŸš€ **Step-01: Create ReplicaSet Definition**

### ğŸ—‚ï¸ **File:** `01-replicaset-definition.yml`

```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: myapp2-rs
spec:
  replicas: 3 # 3 Pods should exist at all times.
  selector:  # Pods label should be defined in ReplicaSet label selector
    matchLabels:
      app: myapp2
  template:
    metadata:
      name: myapp2-pod
      labels:
        app: myapp2 # Atleast 1 Pod label should match with ReplicaSet Label Selector
    spec:
      containers:
      - name: myapp2
        image: stacksimplify/kubenginx:2.0.0
        ports:
          - containerPort: 80
```

---

### ğŸ§± **YAML Object Breakdown**

| ğŸ·ï¸ Field                         | ğŸ’¬ Description                                 |
| --------------------------------- | ---------------------------------------------- |
| **apiVersion**                    | Uses `apps/v1` API for ReplicaSets             |
| **kind**                          | Resource type â†’ `ReplicaSet`                   |
| **metadata.name**                 | Name of the ReplicaSet (`myapp2-rs`)           |
| **spec.replicas**                 | Number of Pod replicas to maintain (`3`)       |
| **spec.selector.matchLabels**     | Identifies Pods managed by this ReplicaSet     |
| **spec.template.metadata.labels** | Pod labels that must match the selector        |
| **spec.template.spec.containers** | Pod container details (`image`, `ports`, etc.) |

---

### âš™ï¸ **Concept Highlight**

ğŸ§© **ReplicaSet** ensures that the specified number of identical Pods are running at all times.
If one Pod is deleted âŒ â†’ ReplicaSet immediately creates another âœ…

---

## ğŸš€ **Step-02: Create ReplicaSet**

### âš™ï¸ **Objective**

Create ReplicaSet with 3 Replicas

---

### ğŸ“œ **Commands**

```bash
# Create ReplicaSet
kubectl apply -f 01-replicaset-definition.yml

# List Replicasets
kubectl get rs
```

---

### ğŸ’¡ **Testing ReplicaSet Self-Healing**

```bash
# List Pods
kubectl get pods

# Delete Pod
kubectl delete pod <Pod-Name>
```

ğŸ¯ **Observation:**
Once a Pod is deleted, the **ReplicaSet automatically recreates** it to maintain 3 replicas.

---

### ğŸ“Š **Expected Output**

| ğŸ§© Command             | ğŸ§¾ Expected Result                                     |
| ---------------------- | ------------------------------------------------------ |
| `kubectl get rs`       | Shows `myapp2-rs` with `DESIRED = CURRENT = READY = 3` |
| `kubectl get pods`     | Lists 3 running Pods created by ReplicaSet             |
| After deleting one Pod | ReplicaSet immediately spawns a new Pod                |

---

### ğŸ” **ReplicaSet Self-Healing Visual**

```text
     +---------------------------------------------+
     |            ReplicaSet: myapp2-rs            |
     | Desired Replicas: 3                         |
     +--------------------+------------------------+
                          |
        +-----------------+-----------------+
        |                 |                 |
        v                 v                 v
    [Pod-1]           [Pod-2]           [Pod-3]
       |                 |                 |
   (Deleted âŒ)      (Running âœ…)       (Running âœ…)
       |
       v
   ReplicaSet recreates Pod instantly âœ…
```

---

## ğŸŒ **Step-03: Create LoadBalancer Service for ReplicaSet**

### ğŸ—‚ï¸ **File:** `02-replicaset-LoadBalancer-servie.yml`

```yaml
apiVersion: v1
kind: Service
metadata:
  name: replicaset-loadbalancer-service
spec:
  type: LoadBalancer 
  selector: 
    app: myapp2 
  ports: 
    - name: http
      port: 80
      targetPort: 80
```

---

### âš™ï¸ **Create LoadBalancer Service & Test**

```bash
# Create LoadBalancer Service
kubectl apply -f 02-replicaset-LoadBalancer-servie.yml

# List LoadBalancer Service
kubectl get svc

# Access Application
http://<Load-Balancer-Service-IP>
```

---

### ğŸŒ **Service Overview Table**

| âš™ï¸ Field             | ğŸ“– Description                                      |
| -------------------- | --------------------------------------------------- |
| **type**             | `LoadBalancer` â€” exposes ReplicaSet Pods externally |
| **selector**         | Matches Pods with label `app: myapp2`               |
| **ports.port**       | External service port (80)                          |
| **ports.targetPort** | Pod container port (80)                             |
| **metadata.name**    | Service name (`replicaset-loadbalancer-service`)    |

---

### ğŸŒˆ **Visual Flow: ReplicaSet + Service**

```text
+--------------------------------------------+
|     LoadBalancer Service ğŸŒ (Port: 80)     |
|  Name: replicaset-loadbalancer-service     |
+----------------------+---------------------+
                       |
                       v
             +--------------------+
             |  ReplicaSet: myapp2-rs  |
             |  Replicas: 3            |
             +----------+--------------+
                        |
     +----------+-------+-------+----------+
     |          |               |          |
     v          v               v          v
 [Pod-1]     [Pod-2]        [Pod-3]     (Scalable)
```

---

## ğŸ§¹ **Step-04: Clean-Up Kubernetes ReplicaSet and Service**

### âš™ï¸ **Commands**

```bash
# Change Directory
cd kube-manifests

# Delete Pod
kubectl delete -f 01-replicaset-definition.yml

# Delete Service
kubectl delete -f 02-replicaset-LoadBalancer-servie.yml
```

---

### âœ… **Clean-Up Verification**

| ğŸ” Resource    | ğŸ§¾ Command         | ğŸ§¹ Expected Result           |
| -------------- | ------------------ | ---------------------------- |
| **ReplicaSet** | `kubectl get rs`   | Deleted successfully         |
| **Pods**       | `kubectl get pods` | No Pods remaining            |
| **Service**    | `kubectl get svc`  | LoadBalancer Service removed |

---

## ğŸ“š **API References**

| ğŸ”— Reference   | ğŸ§­ Purpose                                                |
| -------------- | --------------------------------------------------------- |
| **ReplicaSet** | Learn more about ReplicaSet object structure and behavior |

---

### ğŸ“ **Summary Diagram: Complete Workflow**

```text
[01-replicaset-definition.yml] --> Creates --> ReplicaSet (myapp2-rs)
                                   |
                                   v
                             3 Pods Running ğŸ§©
                                   |
                                   v
[02-replicaset-LoadBalancer-servie.yml] --> Exposes --> Service (replicaset-loadbalancer-service)
                                   |
                                   v
                            External Access ğŸŒ
```

---

### ğŸ **End of SOP**

âœ… You have successfully:

* Created and managed a **ReplicaSet with 3 Pods** âš™ï¸
* Implemented **self-healing** through automatic pod recreation ğŸ”
* Exposed it using a **LoadBalancer Service** ğŸŒ
* Cleaned up resources safely ğŸ§¹

---
