# 🚀 **Kubernetes Deployment — Full SOP**

---

## 📘 **Title**

**Kubernetes - Deployment**

## 🧭 **Description**

Learn and Implement Kubernetes Deployment

---

## 📚 **Kubernetes Deployment - Topics**

| #   | Topic                                                 |
| --- | ----------------------------------------------------- |
| 1️⃣ | Create Deployment                                     |
| 2️⃣ | Scale the Deployment                                  |
| 3️⃣ | Expose Deployment as a Service                        |
| 4️⃣ | Update Deployment                                     |
| 5️⃣ | Rollback Deployment                                   |
| 6️⃣ | Rolling Restarts                                      |
| 7️⃣ | Pause & Resume Deployments                            |
| 8️⃣ | Canary Deployments *(Covered in Declarative Section)* |

---

## 🪄 **Step-01: Introduction to Deployments**

### 💡 What is a Deployment?

A **Kubernetes Deployment** manages **ReplicaSets** and ensures your desired state (number of pods, image version, etc.) is always maintained automatically.

### 🧩 What can we do using Deployment?

* ✅ Create a Deployment
* ✅ Scale the Deployment
* ✅ Expose it as a Service
* ✅ Update or Rollback versions
* ✅ Perform rolling restarts
* ✅ Pause and resume rollouts

---

## ⚙️ **Step-02: Create Deployment**

### 🎯 Objective

Create a Deployment that automatically manages a ReplicaSet and Pods.

**Docker Image:**
🔗 [https://hub.docker.com/repository/docker/stacksimplify/kubenginx](https://hub.docker.com/repository/docker/stacksimplify/kubenginx)

---

### 🧱 **Create Deployment**

```bash
# Create Deployment
kubectl create deployment <Deplyment-Name> --image=<Container-Image>
kubectl create deployment my-first-deployment --image=stacksimplify/kubenginx:1.0.0 
```

---

### 🔍 **Verify Deployment**

```bash
# Verify Deployment
kubectl get deployments
kubectl get deploy 
```

---

### 🧾 **Describe Deployment**

```bash
# Describe Deployment
kubectl describe deployment <deployment-name>
kubectl describe deployment my-first-deployment
```

---

### 🧩 **Verify ReplicaSet**

```bash
# Verify ReplicaSet
kubectl get rs
```

---

### 🧪 **Verify Pod**

```bash
# Verify Pod
kubectl get po
```

---

## 🧠 **Update Change-Cause for the Kubernetes Deployment - Rollout History**

> 🎯 **Observation:**
> Kubernetes tracks **rollout history** for Deployments, allowing easy rollback to previous revisions.

---

### 🔎 **Verify Rollout History**

```bash
# Verify Rollout History
kubectl rollout history deployment/my-first-deployment
```

---

### 🏷️ **Update REVISION CHANGE-CAUSE for Kubernetes Deployment**

```bash
# Update REVISION CHANGE-CAUSE for Kubernetes Deployment
kubectl annotate deployment/my-first-deployment kubernetes.io/change-cause="Deployment CREATE - App Version 1.0.0"
```

---

### 📜 **Verify Rollout History Again**

```bash
# Verify Rollout History
kubectl rollout history deployment/my-first-deployment
```

---

## 📈 **Step-03: Scaling a Deployment**

Scaling helps in handling more load by increasing replicas or optimizing resource cost by scaling down.

---

### 🔼 **Scale Up the Deployment**

```bash
# Scale Up the Deployment
kubectl scale --replicas=10 deployment/<Deployment-Name>
kubectl scale --replicas=10 deployment/my-first-deployment 
```

---

### ✅ **Verify Deployment**

```bash
# Verify Deployment
kubectl get deploy
```

---

### 🔍 **Verify ReplicaSet**

```bash
# Verify ReplicaSet
kubectl get rs
```

---

### 🔎 **Verify Pods**

```bash
# Verify Pods
kubectl get po
```

---

### 🔽 **Scale Down the Deployment**

```bash
# Scale Down the Deployment
kubectl scale --replicas=2 deployment/my-first-deployment 
kubectl get deploy
```

---

## 🌐 **Step-04: Expose Deployment as a Service**

Expose Deployment with a **LoadBalancer Service** to access the app externally from the internet.

---

### 🌍 **Expose Deployment**

```bash
# Expose Deployment as a Service
kubectl expose deployment <Deployment-Name>  --type=LoadBalancer --port=80 --target-port=80 --name=<Service-Name-To-Be-Created>
kubectl expose deployment my-first-deployment --type=LoadBalancer --port=80 --target-port=80 --name=my-first-deployment-service
```

---

### 📡 **Get Service Info**

```bash
# Get Service Info
kubectl get svc
```

---

### 🧭 **Access the Application using Public IP**

```bash
# Access Application
http://<External-IP-from-get-service-output>
curl http://<External-IP-from-get-service-output>
```

---

## 🧩 **Visual Summary**

### ⚙️ Deployment Flow

```text
Deployment
   │
   ├── Controls ReplicaSet(s)
   │       └── Controls Pods
   │               └── Runs Container(s)
```

### 🧠 Deployment vs ReplicaSet vs Pod

| Resource       | Role                                       | Managed By | Use Case                  |
| -------------- | ------------------------------------------ | ---------- | ------------------------- |
| **Pod**        | Smallest deployable unit (runs containers) | ReplicaSet | Runs the app              |
| **ReplicaSet** | Ensures desired number of Pods             | Deployment | Maintains HA              |
| **Deployment** | Manages ReplicaSets and updates            | User       | Rolling updates, rollback |

---

## 🧰 **Real-World Use Case**

Imagine your web app runs fine with 3 pods, but during traffic spikes (e.g., festive season), you need more capacity.
You simply scale:

```bash
kubectl scale --replicas=10 deployment/my-first-deployment
```

No downtime, no manual container management — Kubernetes handles it all automatically. ⚡

---

## 🧾 **Quick Reference Table**

| Task                | Command                                                | Description              |
| ------------------- | ------------------------------------------------------ | ------------------------ |
| Create Deployment   | `kubectl create deployment <name> --image=<image>`     | Create new deployment    |
| View Deployment     | `kubectl get deploy`                                   | List all deployments     |
| Scale Deployment    | `kubectl scale --replicas=<n> deployment/<name>`       | Change pod count         |
| Describe Deployment | `kubectl describe deployment <name>`                   | Get detailed info        |
| Rollout History     | `kubectl rollout history deployment/<name>`            | See deployment revisions |
| Expose as Service   | `kubectl expose deployment <name> --type=LoadBalancer` | Create public endpoint   |

---

## ✅ **Key Takeaways**

* Deployment = top-level controller managing rollout, scale, and rollback.
* ReplicaSets handle pod count; Deployments handle ReplicaSets.
* Scaling and exposing services are seamless and zero-downtime.
* Rollout history = your safety net for quick version rollback.

---
